document.addEventListener("DOMContentLoaded",t=>{let e=document.getElementById("creditSimulation"),r=document.querySelector(".result-container"),n=document.querySelector(".installment-table"),l=n.querySelector("tbody"),d=n.querySelector("tfoot"),o=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}),a=()=>{r.style.display="none",r.querySelectorAll("p span").forEach(t=>{t.innerHTML="&nbsp;"}),l.innerHTML="",d.querySelector("th:not(:first-child)").innerHTML="&nbsp;"},i=(t,e,r,n)=>{let a=(1+e)**r,i=t*e*(a/(a-1));document.getElementById("textInstallment").innerHTML=n+" - "+o.format(i);let c,m,u,f="",s=0,y=0,h=t;for(c=0;c<r;c++)y+=u=e*h,s+=m=i-u,h-=m,h=h<=0?0:h,f+=`<tr><th scope="row">${c+1}</th>`,f+=`<td>${o.format(m)}</td>`,f+=`<td>${o.format(u)}</td>`,f+=`<td>${o.format(i)}</td>`,f+=`<td>${o.format(h)}</td></tr>`;l.innerHTML+=f,d.querySelector(":nth-child(2)").innerHTML=o.format(s),d.querySelector(":nth-child(3)").innerHTML=o.format(y),d.querySelector(":nth-child(4)").innerHTML=o.format(i*r)},c=(t,e,r,n)=>{let a=t/r,i=t*e,c=a+i;document.getElementById("textInstallment").innerHTML=n+" - "+o.format(c);let m,u="",f=0,s=0,y=t;for(m=0;m<r;m++)y-=a,y=y<=0?0:y,f+=a,s+=i,u+=`<tr><th scope="row">${m+1}</th>`,u+=`<td>${o.format(a)}</td>`,u+=`<td>${o.format(i)}</td>`,u+=`<td>${o.format(c)}</td>`,u+=`<td>${o.format(y)}</td></tr>`;l.innerHTML+=u,d.querySelector(":nth-child(2)").innerHTML=o.format(f),d.querySelector(":nth-child(3)").innerHTML=o.format(s),d.querySelector(":nth-child(4)").innerHTML=o.format(c*r)},m=(t,e,r,n)=>{let a=t/r;document.getElementById("textInstallment").innerHTML=n+" - Lihat tabel";let i,c,m,u="",f=0,s=0,y=0,h=t;for(i=0;i<r;i++)y+=m=(c=(t-i*a)*e)+a,h-=a,h=h<=0?0:h,f+=a,s+=c,u+=`<tr><th scope="row">${i+1}</th>`,u+=`<td>${o.format(a)}</td>`,u+=`<td>${o.format(c)}</td>`,u+=`<td>${o.format(m)}</td>`,u+=`<td>${o.format(h)}</td></tr>`;l.innerHTML+=u,d.querySelector(":nth-child(2)").innerHTML=o.format(f),d.querySelector(":nth-child(3)").innerHTML=o.format(s),d.querySelector(":nth-child(4)").innerHTML=o.format(y)};e.querySelector("#csCount").addEventListener("click",t=>{a();let e=Number(document.getElementById("csAmount").value),n=Number(document.getElementById("csInterest").value)/12/100,d=Math.round(Number(document.getElementById("csPeriod").value)),u=document.getElementById("csType"),f=u.options[u.selectedIndex].text;document.getElementById("textPeriod").innerHTML=`${d} bulan`,document.getElementById("textAmount").innerHTML=o.format(e);let s='<tr><th scope="row">0</th><td>0</td><td>0</td>';if(s+=`<td>0</td><td>${o.format(e)}</td></tr>`,l.innerHTML=s,"annuity"===u.value)i(e,n,d,f);else if("flat"===u.value)c(e,n,d,f);else{if("effective"!==u.value)return;m(e,n,d,f)}r.style.display=""}),e.addEventListener("reset",t=>{a()}),e.querySelector('[type="text"]').addEventListener("input",function(t){this.value=this.value.replace(/[^0-9.,]/,"")}),r.querySelector("#csDownload").addEventListener("click",t=>{t.preventDefault();let e={filename:"kalkulasi-kredit.pdf",margin:10};html2pdf().set(e).from(r).save()})});
